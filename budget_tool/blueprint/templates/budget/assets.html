{% extends "budget/base.html" %}

{% block content %}
<div class="mb-8">
    <h2 class="text-2xl font-bold text-zinc-800">Asset Ledger</h2>
    <p class="text-zinc-500 text-sm">Track equipment for the Kansas March 15 Personal Property Rendition.</p>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
    <!-- Add Asset Form -->
    <div class="bg-white p-6 rounded-2xl border border-zinc-200 shadow-sm">
        <h3 class="text-lg font-bold text-zinc-800 mb-6">Log New Asset</h3>
        <form action="{{ url_for('budget.add_asset') }}" method="POST" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-zinc-700 mb-1">Asset Name</label>
                <input type="text" name="name" required placeholder="e.g. MacBook Pro M3"
                       class="w-full px-4 py-3 rounded-xl border border-zinc-300 focus:ring-2 focus:ring-zinc-500 outline-none">
            </div>
            <div>
                <label class="block text-sm font-medium text-zinc-700 mb-1">Purchase Value ($)</label>
                <input type="number" step="0.01" name="value" required placeholder="0.00"
                       class="w-full px-4 py-3 rounded-xl border border-zinc-300 focus:ring-2 focus:ring-zinc-500 outline-none">
            </div>
            <div>
                <label class="block text-sm font-medium text-zinc-700 mb-1">Purchase Date</label>
                <input type="date" name="purchase_date" required
                       class="w-full px-4 py-3 rounded-xl border border-zinc-300 focus:ring-2 focus:ring-zinc-500 outline-none">
            </div>
            <button type="submit"
                    class="w-full bg-zinc-800 text-white font-semibold py-3 rounded-xl hover:bg-zinc-700 transition">
                Save Asset
            </button>
        </form>
    </div>

    <!-- Kansas Info -->
    <div class="bg-zinc-900 text-white p-6 rounded-2xl shadow-sm">
        <h3 class="text-zinc-400 text-xs font-bold uppercase tracking-widest mb-4">Kansas Property Tax Info</h3>
        <div class="space-y-4">
            <div class="p-4 bg-zinc-800 rounded-xl">
                <p class="text-sm font-bold mb-1">Threshold: $1,500</p>
                <p class="text-xs text-zinc-400 leading-relaxed">Assets with a purchase price over $1,500 must be reported on the March 15 Rendition. Assessment rate is 25%.</p>
            </div>
            <div class="p-4 border border-zinc-700 rounded-xl">
                <p class="text-xs font-semibold text-zinc-500 uppercase mb-2">Total Taxable Assets</p>
                {% set taxable_total = 0 %}
                {% for asset in assets if asset.is_taxable_kansas %}
                    {% set taxable_total = taxable_total + asset.value %}
                {% endfor %}
                <p class="text-2xl font-black">${{ "%.2f"|format(taxable_total) }}</p>
                <p class="text-[10px] text-zinc-500 mt-1">Estimated Tax Base: ${{ "%.2f"|format(taxable_total * 0.25) }} (25%)</p>
            </div>
        </div>
    </div>
</div>

<!-- Asset List -->
<div class="bg-white rounded-2xl border border-zinc-200 shadow-sm overflow-hidden">
    <table class="w-full text-left border-collapse">
        <thead>
            <tr class="bg-zinc-50 border-b border-zinc-100">
                <th class="px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider">Asset</th>
                <th class="px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider">Value</th>
                <th class="px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider">Date</th>
                <th class="px-6 py-3 text-xs font-semibold text-zinc-500 uppercase tracking-wider">KS Taxable?</th>
                <th class="px-6 py-3"></th>
            </tr>
        </thead>
        <tbody class="divide-y divide-zinc-100">
            {% for asset in assets %}
            <tr class="hover:bg-zinc-50 transition-colors">
                <td class="px-6 py-4 text-sm font-medium text-zinc-800">{{ asset.name }}</td>
                <td class="px-6 py-4 text-sm text-zinc-600">${{ "%.2f"|format(asset.value) }}</td>
                <td class="px-6 py-4 text-sm text-zinc-500 whitespace-nowrap">{{ asset.purchase_date.strftime('%b %d, %Y') }}</td>
                <td class="px-6 py-4">
                    {% if asset.is_taxable_kansas %}
                    <span class="text-[10px] font-bold px-2 py-0.5 rounded-full bg-red-100 text-red-600 uppercase">Yes</span>
                    {% else %}
                    <span class="text-[10px] font-bold px-2 py-0.5 rounded-full bg-zinc-100 text-zinc-400 uppercase">No</span>
                    {% endif %}
                </td>
                <td class="px-6 py-4 text-right">
                    <form action="{{ url_for('budget.delete_asset', id=asset.id) }}" method="POST" onsubmit="return confirm('Delete this asset?')">
                        <button type="submit" class="text-xs text-red-400 hover:text-red-600">Delete</button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5" class="px-6 py-12 text-center text-zinc-400">No assets tracked yet.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
